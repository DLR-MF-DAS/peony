#!/usr/bin/env python
# -*- coding: utf-8 -*-

from peony.db import download_gee_composite
import os
import click

@click.command()
@click.option("-i", "--geojson", help="GeoJSON to download cloudless composite image for")
@click.option("-o", "--output", help="Output file for the result")
@click.option("--new", is_flag=True)
def main(geojson, output, new):
    tmp_file = output + '.tmp'
    if os.path.exists(tmp_file):
        os.remove(tmp_file)
    download_gee_composite(geojson, tmp_file, collection='COPERNICUS/S2_SR_HARMONIZED', mosaic='median', cloudless_portion=0.6, max_tile_size=16, new_algorithm=new)
    os.rename(tmp_file, output)

if __name__ == '__main__':
    main()
