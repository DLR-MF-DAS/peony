#!/usr/bin/env python
# -*- coding: utf-8 -*-

from peony.db import query_polygon
import click
from jinja2 import Template

@click.command()
@click.option("-p", "--polygon", help="GeoJSON file with a polygon of interest", required=True)
@click.option("-d", "--database", help="SQLite file with the metadata database", required=True)
@click.option("-i", "--template", help="Jinja2 template file to fill in with file names")
@click.option("-o", "--output", help="Output file constructed from the user specified template")
def main(polygon, database, template, output):
    result = query_polygon(database, polygon)
    if template is None:
        for tup in result:
            print(tup[0])
    else:
        with open(template, 'r') as fd:
            j2_template = Template(fd.read())
        with open(output, 'w') as fd:
            fd.write(j2_template.render({'filenames' : result}))

if __name__ == '__main__':
    main()


